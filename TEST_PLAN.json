{
  "name": "Cookie Size Fix",
  "description": "Test de la taille du cookie après le fix",
  "steps": [
    {
      "name": "1. Démarrer le serveur",
      "command": "npm run dev",
      "description": "Le serveur devrait démarrer normalement"
    },
    {
      "name": "2. Ouvrir le navigateur",
      "url": "http://localhost:3000/dev/",
      "description": "La page d'accueil devrait s'afficher"
    },
    {
      "name": "3. Se connecter",
      "action": "Cliquer sur 'Login / Register'",
      "expected": [
        "Redirection vers Keycloak",
        "Connexion réussie",
        "Retour sur /dev/",
        "✅ Pas d'erreur 'cookie too large'"
      ]
    },
    {
      "name": "4. Vérifier les cookies (DevTools)",
      "devtools": "Application > Cookies",
      "verify": [
        "Cookie 'nuxt-session' existe",
        "Taille < 1000 caractères",
        "Pas d'erreur dans la console"
      ]
    },
    {
      "name": "5. Tester l'API",
      "url": "http://localhost:3000/dev/api/auth/session",
      "expected": {
        "user": "Object with keycloakId, email, name, username",
        "loggedInAt": "timestamp"
      },
      "note": "Les tokens ne sont plus visibles (sécurité améliorée)"
    },
    {
      "name": "6. Tester le proxy API",
      "action": "Naviguer vers /dev/bestiary",
      "expected": [
        "Les créatures se chargent",
        "L'Authorization header est ajouté automatiquement",
        "Les API calls fonctionnent normalement"
      ]
    },
    {
      "name": "7. Vérifier le refresh token",
      "url": "http://localhost:3000/dev/api/auth/tokens",
      "expected": {
        "hasAccessToken": true,
        "hasRefreshToken": true,
        "expiresAt": "timestamp",
        "expiresInMs": "positive number"
      }
    },
    {
      "name": "8. Se déconnecter",
      "action": "Cliquer sur 'Logout'",
      "expected": [
        "Session effacée",
        "Tokens supprimés du store serveur",
        "Redirection vers /dev/"
      ]
    }
  ],
  "troubleshooting": {
    "Si le serveur ne démarre pas": [
      "Vérifier que les dépendances sont installées : npm install",
      "Vérifier le fichier .env avec les variables Keycloak"
    ],
    "Si l'erreur 'cookie too large' persiste": [
      "Vérifier que le code est bien modifié",
      "Redémarrer le serveur",
      "Vider les cookies du navigateur"
    ],
    "Si les API calls échouent": [
      "Vérifier que le backend est démarré",
      "Vérifier NUXT_PUBLIC_API_BASE dans .env",
      "Consulter les logs du serveur"
    ]
  }
}
